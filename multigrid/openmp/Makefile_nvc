APP?=driver

ifndef GPU_ARCH
GPU_ARCH = sm_80
$(info GPU_ARCH is not set and defaults to $(GPU_ARCH))
endif

TARGETFLAGS = -fopenmp -omp=gpu

CFLAGS += -Wall -g -O3 $(TARGETFLAGS)

LIBS = -lstdc++ -lm


$(info Compiler flags are: $(CFLAGS))
$(info Linker flags are: $(LIBS))

CC = nvc
CXX = nvc++

OBJ = parser.o problem_definition.o

all: $(APP)

$(APP): $(APP).cpp $(OBJ) print.o
	$(CXX) $(CFLAGS) -std=c++2a -o $@ $^ $(LIBS)

%.o: %.cpp %.h
	$(CXX) $(CFLAGS) -std=c++2a -o $@ -c $<

print.o: print.c
	$(CC) $(CFLAGS) -std=c17 -o $@ -c $<

clean:
	-rm -f $(APP) *.core *.o 
